var M=Object.defineProperty;var G=(v,o,n)=>o in v?M(v,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):v[o]=n;var g=(v,o,n)=>G(v,typeof o!="symbol"?o+"":o,n);import{d as H,j as s,k as J,r as D,o as L,c as O,w as p,a as i,u as a,h as P,_ as Q,i as T}from"../tools-ToolAppBase.vue_vue_type_script_setup_true_lang-Btv-3mZf.js";import{y as S}from"../tools-object-BaSs9UKu.js";import{o as l}from"../tools-SIValueInput.vue_vue_type_script_setup_true_lang-Vk-pPJ9b.js";import{_ as z,C as I}from"../tools-ChartBase.vue_vue_type_script_setup_true_lang-Dj9Zhh_Y.js";import{_ as c}from"../tools-InputRow.vue_vue_type_script_setup_true_lang-DRGfueES.js";class W{constructor(o,n,r){g(this,"kp");g(this,"ki");g(this,"kd");g(this,"previousError");g(this,"integral");this.kp=o,this.ki=n,this.kd=r,this.previousError=0,this.integral=0}calculate(o,n,r){const u=o-n;this.integral+=u*r;const f=(u-this.previousError)/r,y=this.kp*u+this.ki*this.integral+this.kd*f;return this.previousError=u,y}}const X={style:{height:"250px"}},Y={style:{height:"250px"}},Z=H({__name:"PIDApp",setup(v){const o=s(),n=s(),r=s(0),u=s(0),f=s(50),y=s(-1),k=s(.05),b=s(1e-5),A=s(1e-5),q=s(1e-5);J(()=>[r.value,u.value,f.value,y.value,k.value,b.value,A.value,q.value,o.value,n.value],()=>{R()});function K(h){return new I(h,{type:"line",data:{datasets:[],labels:[]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"linear"},y:{type:"linear"}}}})}function $(h){return new I(h,{type:"line",data:{datasets:[],labels:[]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"linear"},y:{type:"linear"}}}})}function R(){var B,E,F,N;const h=new W(b.value,A.value,q.value),e=.1,C=1e3;let d=r.value,m=u.value,t=0;const w=Array(C),U=Array(C);w[0]={x:0,y:d},U[0]={x:0,y:m};for(let V=1;V<C;V++){const j=h.calculate(f.value,d,e);t+=(j*e-t)*k.value,m+=t,d+=(m+y.value)*e,w[V]={x:V*e,y:d},U[V]={x:V*e,y:m}}const _=(B=o.value)==null?void 0:B.getChart(),x=(E=n.value)==null?void 0:E.getChart();_&&_.ready&&S(_.chart,{data:{datasets:[{label:"位置 (m)",data:w,pointStyle:!1,yAxisID:"y",borderColor:"#36A2EB",backgroundColor:"#9BD0F5",hidden:typeof((F=_.chart.data.datasets[0])==null?void 0:F.hidden)>"u"?!1:!_.chart.isDatasetVisible(0)}]}}).update("none"),x&&x.ready&&S(x.chart,{data:{datasets:[{label:"速度 (m/s)",data:U,pointStyle:!1,yAxisID:"y",borderColor:"#FF6384",backgroundColor:"#FFB1C1",hidden:typeof((N=x.chart.data.datasets[0])==null?void 0:N.hidden)>"u"?!1:!x.chart.isDatasetVisible(0)}]}}).update("none")}return(h,e)=>{const C=D("v-divider"),d=D("v-col"),m=D("v-row");return L(),O(Q,null,{default:p(()=>[i(m,null,{default:p(()=>[i(d,{cols:"12",md:"6"},{default:p(()=>[i(c,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),label:"初期位置",variant:"underlined",density:"compact",max:100,min:-100,unit:"m","fraction-digits":3,rule:[a(l).required,a(l).value],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),label:"目標位置",variant:"underlined",density:"compact",max:100,min:-100,unit:"m","fraction-digits":3,rule:[a(l).required,a(l).value],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),label:"初速",variant:"underlined",density:"compact",max:100,min:-100,unit:"m/s","fraction-digits":3,rule:[a(l).required,a(l).value],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=t=>y.value=t),label:"周囲の流速",variant:"underlined",density:"compact",max:100,min:-100,unit:"m/s","fraction-digits":3,rule:[a(l).required,a(l).value],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=t=>k.value=t),label:"加速の応答性",variant:"underlined",density:"compact",max:1,min:1e-4,scale:"log","fraction-digits":4,rule:[a(l).required,a(l).value],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(C,{class:"my-5"}),i(c,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=t=>b.value=t),label:"Kp",variant:"underlined",density:"compact",max:20.0001,min:1e-4,constant:1e-4,scale:"log","fraction-digits":4,rule:[a(l).required,a(l).value,a(l).notNegative],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=t=>A.value=t),label:"Ki",variant:"underlined",density:"compact",max:20.0001,min:1e-4,constant:1e-4,scale:"log","fraction-digits":4,rule:[a(l).required,a(l).value,a(l).notNegative],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:q.value,"onUpdate:modelValue":e[7]||(e[7]=t=>q.value=t),label:"Kd",variant:"underlined",density:"compact",max:20.0001,min:1e-4,constant:1e-4,scale:"log","fraction-digits":4,rule:[a(l).required,a(l).value,a(l).notNegative],cols:"4","hide-details":""},null,8,["modelValue","rule"])]),_:1}),i(d,{cols:"12",md:"6",class:"text-center"},{default:p(()=>[i(m,null,{default:p(()=>[i(d,{cols:"12"},{default:p(()=>[P("div",X,[i(z,{ref_key:"positionChart",ref:o,initializer:K},null,512)])]),_:1}),i(d,{cols:"12"},{default:p(()=>[P("div",Y,[i(z,{ref_key:"velocityChart",ref:n,initializer:$},null,512)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}});T("#app",Z);
