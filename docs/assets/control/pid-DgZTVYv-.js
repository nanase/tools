var O=Object.defineProperty;var X=(v,o,n)=>o in v?O(v,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):v[o]=n;var g=(v,o,n)=>X(v,typeof o!="symbol"?o+"":o,n);import{d as j,r as s,w as G,O as I,a as U,o as H,c as J,b as p,e as i,u as a,X as l,f as N,_ as L,g as Q}from"../tools-AppBase.vue_vue_type_script_setup_true_lang-D3a-CPUg.js";import{_ as S,C as z}from"../tools-ChartBase.vue_vue_type_script_setup_true_lang-K8W-SZDK.js";import{_ as c}from"../tools-InputRow.vue_vue_type_script_setup_true_lang-BNmQSYF_.js";import"../tools-SIValueInput.vue_vue_type_script_setup_true_lang-B6rsi961.js";class T{constructor(o,n,r){g(this,"kp");g(this,"ki");g(this,"kd");g(this,"previousError");g(this,"integral");this.kp=o,this.ki=n,this.kd=r,this.previousError=0,this.integral=0}calculate(o,n,r){const d=o-n;this.integral+=d*r;const f=(d-this.previousError)/r,y=this.kp*d+this.ki*this.integral+this.kd*f;return this.previousError=d,y}}const W={style:{height:"250px"}},Y={style:{height:"250px"}},Z=j({__name:"PIDApp",setup(v){const o=s(),n=s(),r=s(0),d=s(0),f=s(50),y=s(-1),b=s(.05),k=s(1e-5),A=s(1e-5),q=s(1e-5);G(()=>[r.value,d.value,f.value,y.value,b.value,k.value,A.value,q.value,o.value,n.value],()=>{R()});function K(h){return new z(h,{type:"line",data:{datasets:[],labels:[]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"linear"},y:{type:"linear"}}}})}function $(h){return new z(h,{type:"line",data:{datasets:[],labels:[]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"linear"},y:{type:"linear"}}}})}function R(){var B,P,E,F;const h=new T(k.value,A.value,q.value),e=.1,C=1e3;let u=r.value,m=d.value,t=0;const w=Array(C),D=Array(C);w[0]={x:0,y:u},D[0]={x:0,y:m};for(let V=1;V<C;V++){const M=h.calculate(f.value,u,e);t+=(M*e-t)*b.value,m+=t,u+=(m+y.value)*e,w[V]={x:V*e,y:u},D[V]={x:V*e,y:m}}const _=(B=o.value)==null?void 0:B.getChart(),x=(P=n.value)==null?void 0:P.getChart();_&&_.ready&&I(_.chart,{data:{datasets:[{label:"位置 (m)",data:w,pointStyle:!1,yAxisID:"y",borderColor:"#36A2EB",backgroundColor:"#9BD0F5",hidden:typeof((E=_.chart.data.datasets[0])==null?void 0:E.hidden)>"u"?!1:!_.chart.isDatasetVisible(0)}]}}).update("none"),x&&x.ready&&I(x.chart,{data:{datasets:[{label:"速度 (m/s)",data:D,pointStyle:!1,yAxisID:"y",borderColor:"#FF6384",backgroundColor:"#FFB1C1",hidden:typeof((F=x.chart.data.datasets[0])==null?void 0:F.hidden)>"u"?!1:!x.chart.isDatasetVisible(0)}]}}).update("none")}return(h,e)=>{const C=U("v-divider"),u=U("v-col"),m=U("v-row");return H(),J(L,{"page-id":"control/pid","toolbar-title":"PID制御"},{default:p(()=>[i(m,null,{default:p(()=>[i(u,{cols:"12",md:"6"},{default:p(()=>[i(c,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),label:"初期位置",variant:"underlined",density:"compact",max:100,min:-100,unit:"m","fraction-digits":3,rule:[a(l).required,a(l).value],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),label:"目標位置",variant:"underlined",density:"compact",max:100,min:-100,unit:"m","fraction-digits":3,rule:[a(l).required,a(l).value],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value=t),label:"初速",variant:"underlined",density:"compact",max:100,min:-100,unit:"m/s","fraction-digits":3,rule:[a(l).required,a(l).value],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=t=>y.value=t),label:"周囲の流速",variant:"underlined",density:"compact",max:100,min:-100,unit:"m/s","fraction-digits":3,rule:[a(l).required,a(l).value],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t),label:"加速の応答性",variant:"underlined",density:"compact",max:1,min:1e-4,scale:"log","fraction-digits":4,rule:[a(l).required,a(l).value],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(C,{class:"my-5"}),i(c,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=t=>k.value=t),label:"Kp",variant:"underlined",density:"compact",max:20.0001,min:1e-4,constant:1e-4,scale:"log","fraction-digits":4,rule:[a(l).required,a(l).value,a(l).notNegative],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=t=>A.value=t),label:"Ki",variant:"underlined",density:"compact",max:20.0001,min:1e-4,constant:1e-4,scale:"log","fraction-digits":4,rule:[a(l).required,a(l).value,a(l).notNegative],cols:"4","hide-details":""},null,8,["modelValue","rule"]),i(c,{modelValue:q.value,"onUpdate:modelValue":e[7]||(e[7]=t=>q.value=t),label:"Kd",variant:"underlined",density:"compact",max:20.0001,min:1e-4,constant:1e-4,scale:"log","fraction-digits":4,rule:[a(l).required,a(l).value,a(l).notNegative],cols:"4","hide-details":""},null,8,["modelValue","rule"])]),_:1}),i(u,{cols:"12",md:"6",class:"text-center"},{default:p(()=>[i(m,null,{default:p(()=>[i(u,{cols:"12"},{default:p(()=>[N("div",W,[i(S,{ref_key:"positionChart",ref:o,initializer:K},null,512)])]),_:1}),i(u,{cols:"12"},{default:p(()=>[N("div",Y,[i(S,{ref_key:"velocityChart",ref:n,initializer:$},null,512)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}});Q("#app",Z);
