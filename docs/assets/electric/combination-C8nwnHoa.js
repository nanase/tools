var ne=Object.defineProperty;var oe=(_,e,t)=>e in _?ne(_,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):_[e]=t;var j=(_,e,t)=>oe(_,typeof e!="symbol"?e+"":e,t);import{S as z,d as Q,r as g,a as m,o as V,i as k,e as n,b as o,F as B,j as H,c as F,u as p,k as $,t as E,f as L,n as ue,l as re,h as A,R as v,m as se,p as ie,q as ce,s as de,_ as pe,g as ve}from"../tools-SIValueInput.vue_vue_type_script_setup_true_lang-BTbVBeTJ.js";import{W as me}from"../tools-worker-DEQy9XtV.js";import{t as fe}from"../tools-object-DXBQZyn3.js";const G={E1:[100],E3:[100,220,470],E6:[100,150,220,330,470,680],E12:[100,120,150,180,220,270,330,390,470,560,680,820],E24:[100,110,120,130,150,160,180,200,220,240,270,300,330,360,390,430,470,510,560,620,680,750,820,910],E48:[100,105,110,115,121,127,133,140,147,154,162,169,178,187,196,205,215,226,237,249,261,274,287,301,316,332,348,365,383,402,422,442,464,487,511,536,562,590,619,649,681,715,750,787,825,866,909,953],E96:[100,102,105,107,110,113,115,118,121,124,127,130,133,137,140,143,147,150,154,158,162,165,169,174,178,182,187,191,196,200,205,210,215,221,226,232,237,243,249,261,267,274,280,287,294,301,309,316,324,332,340,348,357,365,374,383,392,402,412,422,432,442,453,464,475,487,499,511,523,536,549,562,576,590,604,619,634,649,681,698,715,732,750,768,787,806,825,845,866,887,909,931,953,976],E192:[100,101,102,104,105,106,107,109,110,111,113,114,115,117,118,120,121,123,124,126,127,129,130,132,133,135,137,138,140,142,143,145,147,149,150,152,154,156,158,160,162,164,165,167,169,172,174,176,178,180,182,184,187,189,191,193,196,198,200,203,205,208,210,213,215,218,221,223,226,229,232,234,237,240,243,246,249,252,255,258,261,264,267,271,274,277,280,284,287,291,294,298,301,305,309,312,316,320,324,328,332,336,340,344,348,352,357,361,365,370,374,379,383,388,392,397,402,407,412,417,422,427,432,437,442,448,453,459,464,470,475,481,487,493,499,505,511,517,523,530,536,542,549,556,562,569,576,583,590,597,604,612,619,626,634,642,649,657,665,673,681,690,698,706,715,723,732,741,750,759,768,777,787,796,806,816,825,835,845,856,866,876,887,898,909,920,931,942,953,965,976,988]};class y{constructor(e){j(this,"componentNodes");j(this,"syntaxTree");this.componentNodes=structuredClone(e),this.syntaxTree=y.generateSyntaxTree(e)}equals(e){return y.equalsInternal(this.syntaxTree,e.syntaxTree)}toString(e=["T","G","M","k","","m","μ","n","p","f"],t=3){return y.toStringInternal(this.syntaxTree,e,t)}calcValue(e){return e==="capacitor"?y.calcValueForCapacitorInternal(this.componentNodes):y.calcValueInternal(this.componentNodes)}static calcValue(e,t){return t==="capacitor"?y.calcValueForCapacitorInternal(e):y.calcValueInternal(e)}static equalsInternal(e,t){if(e.type!==t.type||e.children.length!==t.children.length)return!1;const l=[...e.children].sort(y.compareNodes),r=[...t.children].sort(y.compareNodes);return l.every((s,u)=>y.deepCompare(s,r[u]))}static compareNodes(e,t){return e.type==="term"&&t.type==="term"?e.children-t.children:e.type==="term"?-1:t.type==="term"?1:e.type.localeCompare(t.type)}static deepCompare(e,t){return e.type!==t.type?!1:e.type==="term"&&t.type==="term"?e.children===t.children:e.type!=="term"&&t.type!=="term"?y.equalsInternal(e,t):!1}static generateSyntaxTree(e){const t=[];for(let l=e.length-1;l>=0;l--){const r=e[l],s=[];if(r==="+"){const u=t.pop(),i=t.pop();u.type==="series"?s.push(...u.children):s.push(u),i.type==="series"?s.push(...i.children):s.push(i),t.push({type:"series",children:s})}else if(r==="|"){const u=t.pop(),i=t.pop();u.type==="parallel"?s.push(...u.children):s.push(u),i.type==="parallel"?s.push(...i.children):s.push(i),t.push({type:"parallel",children:s})}else t.push({type:"term",children:r.value})}if(t[0].type!=="term")return t[0];throw new Error("invalid nodes")}static toStringInternal(e,t,l){return e.children.map(r=>r.type==="term"?z.fit(r.children,t).toSimpleString(l):`(${y.toStringInternal(r,t,l)})`).join(e.type==="series"?" + ":" | ")}static calcValueInternal(e){const t=[];for(let l=e.length-1;l>=0;l--){const r=e[l];if(r==="+"){const s=t.pop(),u=t.pop();t.push(s+u)}else if(r==="|"){const s=t.pop(),u=t.pop();t.push(s*u/(s+u))}else t.push(r.value)}return t[0]}static calcValueForCapacitorInternal(e){const t=[];for(let l=e.length-1;l>=0;l--){const r=e[l];if(r==="+"){const s=t.pop(),u=t.pop();t.push(s*u/(s+u))}else if(r==="|"){const s=t.pop(),u=t.pop();t.push(s+u)}else t.push(r.value)}return t[0]}}const be=Q({__name:"ResultTable",props:{results:null},setup(_){const e=g();function t(s,u){const i=s.calcValue(u.componentType.value);if(i===u.targetComponentValue)return"= 正確";const b=(i-u.targetComponentValue)/u.targetComponentValue*100;return Math.abs(b)<.001?b>0?"< +0.001":"< -0.001":(b>0?"+":"")+b.toFixed(3)}function l(s){return[{title:`${s.componentType.valueLabel} (${s.componentType.unit})`,value:"value"},{title:"誤差率 (%)",value:"error"},{title:"組み合わせ",value:"combination"}]}function r(s,u){return s.map(i=>{const b=i.calcValue(u.componentType.value);return{value:z.fit(b,u.componentType.prefixSymbols).toSimpleString(3),isBestValue:b===u.bestComponentValue,error:t(i,u),combination:i.toString(u.componentType.prefixSymbols)}})}return(s,u)=>{const i=m("v-tab"),b=m("v-tabs"),S=m("v-data-table"),q=m("v-tabs-window-item"),U=m("v-tabs-window");return V(),k(B,null,[n(b,{modelValue:e.value,"onUpdate:modelValue":u[0]||(u[0]=f=>e.value=f),"align-tabs":"center","bg-color":"secondary"},{default:o(()=>[(V(!0),k(B,null,H(_.results,f=>(V(),F(i,{key:f.componentNumber,"prepend-icon":p(fe)(f.finished,f.finishReason==="finishedAllCombination"?"mdi-check-all":f.finishReason==="aborted"?"mdi-progress-alert":"mdi-check","mdi-timer-sand","mdi-circle-medium")},{default:o(()=>[$(E(f.componentNumber)+"本の解 ",1)]),_:2},1032,["prepend-icon"]))),128))]),_:1},8,["modelValue"]),n(U,{modelValue:e.value,"onUpdate:modelValue":u[1]||(u[1]=f=>e.value=f)},{default:o(()=>[(V(!0),k(B,null,H(_.results,f=>(V(),F(q,{key:f.componentNumber},{default:o(()=>[n(S,{items:r(f.resultCombinations??[],f),headers:l(f),density:"compact",class:"result-table","no-data-text":"まだ計算されていません","items-per-page-text":"ページごとの表示数:","page-text":"全{2}個の結果 / {0}-{1}"},{item:o(({item:R})=>[L("tr",{class:ue({"best-combination":R.isBestValue})},[L("td",null,E(R.value),1),L("td",null,E(R.error),1),L("td",null,E(R.combination),1)],2)]),_:2},1032,["items","headers"])]),_:2},1024))),128))]),_:1},8,["modelValue"])],64)}}});function ye(_){return new Worker("/tools/assets/worker-BjxQQydT.js",{name:_==null?void 0:_.name})}const P=[{title:"抵抗器 (Ω)",value:"resistor",unit:"Ω",valueLabel:"抵抗値",prefixSymbols:["G","M","k","","m","μ"]},{title:"コンデンサ (F)",value:"capacitor",unit:"F",valueLabel:"静電容量",prefixSymbols:["","m","μ","n","p"]},{title:"インダクタ (H)",value:"inductor",unit:"H",valueLabel:"インダクタンス",prefixSymbols:["","m","μ","n"]}],W=[{title:"E1",value:"E1"},{title:"E3",value:"E3"},{title:"E6",value:"E6"},{title:"E12",value:"E12"},{title:"E24",value:"E24"},{title:"E48",value:"E48"},{title:"E96",value:"E96"},{title:"E192",value:"E192"}],Z=[{title:"< 0.1%",value:.001},{title:"< 0.01%",value:1e-4},{title:"< 0.001%",value:1e-5},{title:"= 0.0%（正確）",value:0},{title:"全探索",value:void 0}],_e={resistor:{componentTargetValue:1234,minValue:10,maxValue:1e6,excludedValuePlaceholder:1e3,excludedValues:[]},capacitor:{componentTargetValue:1234e-9,minValue:1e-12,maxValue:1,excludedValuePlaceholder:1e-6,excludedValues:[]},inductor:{componentTargetValue:1234e-7,minValue:1e-9,maxValue:1,excludedValuePlaceholder:1e-5,excludedValues:[]}},Ve={key:0},xe={key:1},he={key:2},ge={key:3},ke={key:4},Ee=L("div",null,"計算中",-1),Ce=L("div",{class:"text-caption"},"クリックで中止",-1),Te=Q({__name:"App",setup(_){const e=g([2,3,4,5].map(x=>({componentNumber:x,componentType:P[0],targetComponentValue:1234,series:G[W[3].value],minValue:0,maxValue:0,excludedValues:[],targetErrorRate:Z[2]}))),t=g(0),l=g(P[0]),r=g(_e),s=g(W[3]),u=g(Z[2]),i=g(),b=g(),S=g(1e3),q=new me(ye),U=re(()=>{if(!i.value)return 0;const x=e.value[t.value];return typeof x.currentCombination>"u"||typeof x.totalCombinations>"u"||x.totalCombinations===0?0:x.currentCombination/x.totalCombinations*100});async function f(){var d,w;i.value=!0;let x=0;for(const a of e.value)a.componentType=l.value,a.targetComponentValue=r.value[l.value.value].componentTargetValue,a.minValue=r.value[l.value.value].minValue,a.maxValue=r.value[l.value.value].maxValue,a.excludedValues=r.value[l.value.value].excludedValues,a.series=G[s.value.value],a.targetErrorRate=u.value,a.finished=void 0,a.finishReason=void 0,a.bestComponentValue=0,a.resultCombinations=[],a.totalCombinations=0,a.currentCombination=0;for(const a of e.value){if(b.value)break;for(t.value=x++,a.finished=!1,a.finishReason="calculating",await q.invoke({type:"initialize",value:a.targetComponentValue,componentType:a.componentType.value,componentNumber:a.componentNumber,series:[...a.series],minValue:a.minValue,maxValue:a.maxValue,excludedValues:[...a.excludedValues],progressBeacon:1e6});!b.value;){const h=await q.invoke({type:"invoke"});if(h.type!=="invoke"){a.finishReason="error";break}if(h.result){const I=h.result;if(a.currentCombination=I.current,a.totalCombinations=I.total,I.componentNodes){const N=new y(I.componentNodes);if(!((d=a.resultCombinations)!=null&&d.some(C=>C.equals(N)))){(w=a.resultCombinations)==null||w.unshift(N),a.bestComponentValue=N.calcValue(a.componentType.value);const C=(a.bestComponentValue-a.targetComponentValue)/a.targetComponentValue;if(typeof a.targetErrorRate.value=="number"&&Math.abs(C)<=a.targetErrorRate.value){a.finishReason="finishedByUnderErrorRate";break}}}}if(h.done){a.finishReason="finishedAllCombination";break}}b.value&&(a.finishReason="aborted"),a.finished=!0}b.value=!1,i.value=!1}function R(){[v.required,v.value,v.notNegative,v.notZero].every(x=>x(S.value.toString())===!0)&&!r.value[l.value.value].excludedValues.includes(S.value)&&r.value[l.value.value].excludedValues.push(S.value)}async function D(){i.value?b.value=!0:await f()}return(x,d)=>{const w=m("v-select"),a=m("v-col"),h=m("v-row"),I=m("v-combobox"),N=m("v-card-text"),C=m("v-btn"),J=m("v-form"),K=m("v-icon"),O=m("v-list-item"),X=m("v-list"),Y=m("v-spacer"),ee=m("v-card-actions"),te=m("v-card"),le=m("v-dialog"),ae=m("v-progress-linear");return V(),F(pe,{"page-id":"electric/combination","toolbar-title":"受動素子 組み合わせ計算機"},{default:o(()=>[n(h,null,{default:o(()=>[n(a,{cols:"4"},{default:o(()=>[n(w,{label:"素子の種類",density:"compact",variant:"underlined",modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=c=>l.value=c),items:p(P),"hide-details":"","return-object":""},null,8,["modelValue","items"])]),_:1}),n(a,{cols:"8"},{default:o(()=>[n(A,{value:r.value[l.value.value].componentTargetValue,"onUpdate:value":d[1]||(d[1]=c=>r.value[l.value.value].componentTargetValue=c),label:`求める${l.value.valueLabel}`,variant:"underlined",density:"compact",unit:l.value.unit,"fraction-digits":3,"prefix-symbols":l.value.prefixSymbols,rule:[p(v).required,p(v).value,p(v).notNegative,p(v).notZero],"hide-details":""},null,8,["value","label","unit","prefix-symbols","rule"])]),_:1})]),_:1}),n(h,null,{default:o(()=>[n(a,{cols:"4"},{default:o(()=>[n(w,{label:"E系列",density:"compact",variant:"underlined",modelValue:s.value,"onUpdate:modelValue":d[2]||(d[2]=c=>s.value=c),items:p(W),"hide-details":"","return-object":""},null,8,["modelValue","items"])]),_:1}),n(a,{cols:"8"},{default:o(()=>[n(le,{"max-width":"600"},{activator:o(({props:c})=>[n(I,se(c,{multiple:"","model-value":r.value[l.value.value].excludedValues,label:`除外する${l.value.valueLabel}（オプション）`,suffix:l.value.unit,density:"compact",variant:"underlined","hide-details":"",readonly:""}),null,16,["model-value","label","suffix"])]),default:o(({isActive:c})=>[n(te,{title:`除外する${l.value.valueLabel}`},{default:o(()=>[n(N,null,{default:o(()=>[$(" 目標の"+E(l.value.valueLabel)+"以外にも、組み合わせに使用しない"+E(l.value.valueLabel)+"を複数指定できます。 ",1)]),_:1}),n(N,null,{default:o(()=>[n(J,{onSubmit:ie(R,["prevent"])},{default:o(()=>[n(h,null,{default:o(()=>[n(a,null,{default:o(()=>[n(A,{value:S.value,"onUpdate:value":d[3]||(d[3]=T=>S.value=T),label:`除外の対象に追加する${l.value.valueLabel}`,variant:"underlined",density:"compact",unit:l.value.unit,"fraction-digits":3,"prefix-symbols":l.value.prefixSymbols,rule:[p(v).required,p(v).value,p(v).notNegative,p(v).notZero],"hide-details":""},null,8,["value","label","unit","prefix-symbols","rule"])]),_:1}),n(a,{cols:"3"},{default:o(()=>[n(C,{color:"success",type:"submit",variant:"outlined",block:""},{default:o(()=>[$("追加")]),_:1})]),_:1}),n(a,{cols:"3"},{default:o(()=>[n(C,{variant:"outlined",block:"",onClick:d[4]||(d[4]=T=>r.value[l.value.value].excludedValues=[])},{default:o(()=>[$(" 全てクリア ")]),_:1})]),_:1})]),_:1})]),_:1}),n(X,{density:"compact","onClick:select":d[5]||(d[5]=T=>r.value[l.value.value].excludedValues=r.value[l.value.value].excludedValues.filter(M=>M!==T.id))},{default:o(()=>[(V(!0),k(B,null,H(r.value[l.value.value].excludedValues,(T,M)=>(V(),F(O,{key:M,value:T,slim:""},{prepend:o(()=>[n(K,{icon:"mdi-close"})]),default:o(()=>[$(E(p(z).fit(T,l.value.prefixSymbols))+E(l.value.unit)+" ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1}),n(ee,null,{default:o(()=>[n(Y),n(C,{text:"閉じる",onClick:T=>c.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1})]),_:1})]),_:1}),n(h,null,{default:o(()=>[n(a,{cols:"4"},{default:o(()=>[n(A,{value:r.value[l.value.value].minValue,"onUpdate:value":d[6]||(d[6]=c=>r.value[l.value.value].minValue=c),label:`使用する最小の${l.value.valueLabel}`,variant:"underlined",density:"compact",unit:l.value.unit,"fraction-digits":0,"prefix-symbols":l.value.prefixSymbols,rule:[p(v).required,p(v).value,p(v).notNegative,p(v).notZero],"hide-details":""},null,8,["value","label","unit","prefix-symbols","rule"])]),_:1}),n(a,{cols:"4"},{default:o(()=>[n(A,{value:r.value[l.value.value].maxValue,"onUpdate:value":d[7]||(d[7]=c=>r.value[l.value.value].maxValue=c),label:`使用する最大の${l.value.valueLabel}`,variant:"underlined",density:"compact",unit:l.value.unit,"fraction-digits":0,"prefix-symbols":l.value.prefixSymbols,rule:[p(v).required,p(v).value,p(v).notNegative,p(v).notZero],"hide-details":""},null,8,["value","label","unit","prefix-symbols","rule"])]),_:1}),n(a,{cols:"4"},{default:o(()=>[n(w,{label:"計算を終える誤差率",density:"compact",variant:"underlined",modelValue:u.value,"onUpdate:modelValue":d[8]||(d[8]=c=>u.value=c),items:p(Z),"hide-details":"","return-object":""},null,8,["modelValue","items"])]),_:1})]),_:1}),n(h,null,{default:o(()=>[n(a,{"align-self":"center"},{default:o(()=>[n(ae,{color:"light-blue",modelValue:U.value,"onUpdate:modelValue":d[9]||(d[9]=c=>U.value=c),height:"20",striped:i.value},{default:o(()=>[i.value?(V(),k("strong",Ve,"計算中... "+E(U.value.toFixed(3))+"%",1)):e.value.some(c=>c.finishReason==="aborted")?(V(),k("strong",xe,"計算を中止しました")):e.value.some(c=>c.finishReason==="error")?(V(),k("strong",he," エラーにより計算を中止しました ")):e.value.some(c=>c.finishReason==="finishedByUnderErrorRate")?(V(),k("strong",ge," 計算が完了しました ")):e.value.every(c=>c.finishReason==="finishedAllCombination")?(V(),k("strong",ke," 全探索が完了しました ")):ce("",!0)]),_:1},8,["modelValue","striped"])]),_:1}),n(a,{cols:"4"},{default:o(()=>[n(C,{"prepend-icon":i.value?"mdi-timer-sand":"mdi-play",variant:i.value?"outlined":"flat",color:i.value?"error":"success",onClick:D,block:""},de({_:2},[i.value?{name:"default",fn:o(()=>[Ee,Ce]),key:"0"}:{name:"default",fn:o(()=>[$("計算開始")]),key:"1"}]),1032,["prepend-icon","variant","color"])]),_:1})]),_:1}),n(h,null,{default:o(()=>[n(a,null,{default:o(()=>[n(be,{results:e.value},null,8,["results"])]),_:1})]),_:1})]),_:1})}}});ve("#app",Te);
