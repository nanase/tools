var O=Object.defineProperty;var S=(b,m,w)=>m in b?O(b,m,{enumerable:!0,configurable:!0,writable:!0,value:w}):b[m]=w;var x=(b,m,w)=>S(b,typeof m!="symbol"?m+"":m,w);(function(){"use strict";function b(l,t){const n=l.length;if(n!=t.length)throw new RangeError("Mismatched lengths");n!=0&&(n&n-1?_(l,t):w(l,t))}function m(l,t){b(t,l)}function w(l,t){const n=l.length;if(n!=t.length)throw new RangeError("Mismatched lengths");if(n==1)return;let e=-1;for(let s=0;s<32;s++)1<<s==n&&(e=s);if(e==-1)throw new RangeError("Length is not a power of 2");const o=new Array(n/2),i=new Array(n/2);for(let s=0;s<n/2;s++)o[s]=Math.cos(2*Math.PI*s/n),i[s]=Math.sin(2*Math.PI*s/n);for(let s=0;s<n;s++){const h=r(s,e);if(h>s){let u=l[s];l[s]=l[h],l[h]=u,u=t[s],t[s]=t[h],t[h]=u}}for(let s=2;s<=n;s*=2){const h=s/2,u=n/s;for(let g=0;g<n;g+=s)for(let p=g,a=0;p<g+h;p++,a+=u){const y=p+h,L=l[y]*o[a]+t[y]*i[a],P=-l[y]*i[a]+t[y]*o[a];l[y]=l[p]-L,t[y]=t[p]-P,l[p]+=L,t[p]+=P}}function r(s,h){let u=0;for(let g=0;g<h;g++)u=u<<1|s&1,s>>>=1;return u}}function _(l,t){const n=l.length;if(n!=t.length)throw new RangeError("Mismatched lengths");let e=1;for(;e<n*2+1;)e*=2;const o=new Array(n),i=new Array(n);for(let a=0;a<n;a++){const y=a*a%(n*2);o[a]=Math.cos(Math.PI*y/n),i[a]=Math.sin(Math.PI*y/n)}const r=q(e),s=q(e);for(let a=0;a<n;a++)r[a]=l[a]*o[a]+t[a]*i[a],s[a]=-l[a]*i[a]+t[a]*o[a];const h=q(e),u=q(e);h[0]=o[0],u[0]=i[0];for(let a=1;a<n;a++)h[a]=h[e-a]=o[a],u[a]=u[e-a]=i[a];const g=new Array(e),p=new Array(e);F(r,s,h,u,g,p);for(let a=0;a<n;a++)l[a]=g[a]*o[a]+p[a]*i[a],t[a]=-g[a]*i[a]+p[a]*o[a]}function F(l,t,n,e,o,i){const r=l.length;if(r!=t.length||r!=n.length||r!=e.length||r!=o.length||r!=i.length)throw new RangeError("Mismatched lengths");l=l.slice(),t=t.slice(),n=n.slice(),e=e.slice(),b(l,t),b(n,e);for(let s=0;s<r;s++){const h=l[s]*n[s]-t[s]*e[s];t[s]=t[s]*n[s]+l[s]*e[s],l[s]=h}m(l,t);for(let s=0;s<r;s++)o[s]=l[s]/r,i[s]=t[s]/r}function q(l){const t=[];for(let n=0;n<l;n++)t.push(0);return t}class M{constructor(t){x(this,"_coefficients",new Float64Array(6));x(this,"_normalizedCoefficients",new Float64Array(5));x(this,"_impluseResponse");x(this,"_real");x(this,"_imag");x(this,"_phaseResponse");x(this,"_frequencyResponse");this.impulseLength=t,this._impluseResponse=new Float64Array(this.impulseLength),this._real=new Float64Array(this.impulseLength),this._imag=new Float64Array(this.impulseLength),this._phaseResponse=new Float64Array(this.impulseLength/2),this._frequencyResponse=new Float64Array(this.impulseLength/2)}setFilter(t,n,e,o){M[t](this._coefficients,n,e,o),M.normalizeCoefficients(this._coefficients,this._normalizedCoefficients),M.calcImpulseResponse(this._impluseResponse,this._normalizedCoefficients)}transform(){for(let t=0;t<this.impulseLength;t++)this._real[t]=this._impluseResponse[t],this._imag[t]=0;b(this._real,this._imag);for(let t=0;t<this.impulseLength/2;t++)this._phaseResponse[t]=Math.atan2(this._imag[t],this._real[t])*180/Math.PI,this._frequencyResponse[t]=Math.log10(Math.sqrt(this._real[t]*this._real[t]+this._imag[t]*this._imag[t]))*20}get coefficients(){return this._coefficients}get normalizedCoefficients(){return this._normalizedCoefficients}get impluseResponse(){return this._impluseResponse}get phaseResponse(){return this._phaseResponse}get frequencyResponse(){return this._frequencyResponse}static normalizeCoefficients(t,n){const e=n??new Float64Array(5);return e[0]=t[0]/t[3],e[1]=t[1]/t[3],e[2]=t[2]/t[3],e[3]=-t[4]/t[3],e[4]=-t[5]/t[3],e}static calcImpulseResponse(t,n){if(n.length!==5)throw new Error("Coefficients must to be normalized.");let[e,o,i,r,s]=[0,0,1,0,0];for(let h=0;h<t.length;h++)t[h]=n[0]*i+n[1]*r+n[2]*s+n[3]*e+n[4]*o,s=r,r=i,o=e,e=t[h],i=0}static calcOmega(t,n){return 2*Math.PI*n/t}static lowpass(t,n,e,o){const i=(o==null?void 0:o.q)??Math.SQRT1_2,r=M.calcOmega(n,e),s=Math.sin(r)/(2*i);return t[0]=(1-Math.cos(r))/2,t[1]=1-Math.cos(r),t[2]=(1-Math.cos(r))/2,t[3]=1+s,t[4]=-2*Math.cos(r),t[5]=1-s,t}static highpass(t,n,e,o){const i=(o==null?void 0:o.q)??Math.SQRT1_2,r=M.calcOmega(n,e),s=Math.sin(r)/(2*i);return t[0]=(1+Math.cos(r))/2,t[1]=-(1+Math.cos(r)),t[2]=(1+Math.cos(r))/2,t[3]=1+s,t[4]=-2*Math.cos(r),t[5]=1-s,t}static bandpass(t,n,e,o){const i=(o==null?void 0:o.q)??Math.SQRT1_2,r=M.calcOmega(n,e),s=Math.sin(r)/(2*i);return t[0]=s,t[1]=0,t[2]=-s,t[3]=1+s,t[4]=-2*Math.cos(r),t[5]=1-s,t}static bandstop(t,n,e,o){const i=(o==null?void 0:o.q)??Math.SQRT1_2,r=M.calcOmega(n,e),s=Math.sin(r)/(2*i);return t[0]=1,t[1]=-2*Math.cos(r),t[2]=1,t[3]=1+s,t[4]=-2*Math.cos(r),t[5]=1-s,t}static lowshelf(t,n,e,o){const i=(o==null?void 0:o.gain)??0,r=(o==null?void 0:o.q)??Math.SQRT1_2,s=M.calcOmega(n,e),h=Math.pow(10,i/40),u=Math.sqrt(h)/r;return t[0]=h*(h+1-(h-1)*Math.cos(s)+u*Math.sin(s)),t[1]=2*h*(h-1-(h+1)*Math.cos(s)),t[2]=h*(h+1-(h-1)*Math.cos(s)-u*Math.sin(s)),t[3]=h+1+(h-1)*Math.cos(s)+u*Math.sin(s),t[4]=-2*(h-1+(h+1)*Math.cos(s)),t[5]=h+1+(h-1)*Math.cos(s)-u*Math.sin(s),t}static highshelf(t,n,e,o){const i=(o==null?void 0:o.gain)??0,r=(o==null?void 0:o.q)??Math.SQRT1_2,s=M.calcOmega(n,e),h=Math.pow(10,i/40),u=Math.sqrt(h)/r;return t[0]=h*(h+1+(h-1)*Math.cos(s)+u*Math.sin(s)),t[1]=-2*h*(h-1+(h+1)*Math.cos(s)),t[2]=h*(h+1+(h-1)*Math.cos(s)-u*Math.sin(s)),t[3]=h+1-(h-1)*Math.cos(s)+u*Math.sin(s),t[4]=2*(h-1-(h+1)*Math.cos(s)),t[5]=h+1-(h-1)*Math.cos(s)-u*Math.sin(s),t}static peaking(t,n,e,o){const i=(o==null?void 0:o.gain)??0,r=(o==null?void 0:o.q)??Math.SQRT1_2,s=M.calcOmega(n,e),h=Math.sin(s)/(2*r),u=Math.pow(10,i/40);return t[0]=1+h*u,t[1]=-2*Math.cos(s),t[2]=1-h*u,t[3]=1+h/u,t[4]=-2*Math.cos(s),t[5]=1-h/u,t}static allpass(t,n,e,o){const i=(o==null?void 0:o.q)??Math.SQRT1_2,r=M.calcOmega(n,e),s=Math.sin(r)/(2*i);return t[0]=1-s,t[1]=-2*Math.cos(r),t[2]=1+s,t[3]=1+s,t[4]=-2*Math.cos(r),t[5]=1-s,t}}var T=Object.defineProperty,A=(l,t,n)=>t in l?T(l,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[t]=n,I=(l,t,n)=>A(l,t+"",n);function f(l){let t=-1/0,n=1/0,e=-1,o=-1,i=0;for(const r of l)r>t&&(t=r,e=i),r<n&&(n=r,o=i),i++;return{max:t,min:n,maxIndex:e,minIndex:o}}const d={symbol:"",exponent:0},R=[{symbol:"Q",exponent:30},{symbol:"R",exponent:27},{symbol:"Y",exponent:24},{symbol:"Z",exponent:21},{symbol:"E",exponent:18},{symbol:"P",exponent:15},{symbol:"T",exponent:12},{symbol:"G",exponent:9},{symbol:"M",exponent:6},{symbol:"k",exponent:3},{symbol:"h",exponent:2},{symbol:"da",exponent:1},d,{symbol:"d",exponent:-1},{symbol:"c",exponent:-2},{symbol:"m",exponent:-3},{symbol:"μ",exponent:-6},{symbol:"u",exponent:-6},{symbol:"n",exponent:-9},{symbol:"p",exponent:-12},{symbol:"f",exponent:-15},{symbol:"a",exponent:-18},{symbol:"z",exponent:-21},{symbol:"y",exponent:-24},{symbol:"r",exponent:-27},{symbol:"q",exponent:-30}];I(class c{constructor(t,n){this.fraction=t,this.prefix=n}get actualValue(){return this.fraction*10**this.prefix.exponent}toString(){return`${this.fraction}${this.prefix.symbol}`}toSimpleString(t){return`${Number(this.fraction.toFixed(t))}${this.prefix.symbol}`}toFixed(t){return`${this.fraction.toFixed(t)}${this.prefix.symbol}`}static getPrefixSymbols(t){return R.filter(n=>n.exponent%(t?1:3)===0).map(n=>n.symbol)}static test(t){return c.siValuePattern.test(t??"")}static parse(t){const n=c.siValuePattern.exec(t??"");if(n==null)return new c(Number.NaN,d);const e=Number.parseFloat(n[1]),o=R.find(i=>i.symbol===n[2]);return new c(e,o)}static fit(t,n){if(!Number.isFinite(t)&&n.length===0)return new c(t,d);if(t!==0){const e=Math.sign(t);t=Math.abs(t);const o=n.map(i=>{const r=c.getPrefix(i),s=t*10**-r.exponent,h=Math.abs(s-500);return{prefix:r,practicalValue:s,rank:h}}).sort((i,r)=>i.rank-r.rank);return new c(o[0].practicalValue*e,o[0].prefix)}else return new c(0,d)}static fitBy(t,n){const e=c.getPrefix(n);if(!Number.isFinite(t))return new c(t,e);const o=Math.sign(t);t=Math.abs(t);const i=t*10**-e.exponent;return new c(i*o,e)}static getPrefix(t){const n=R.find(e=>e.symbol===t);if(!n)throw new Error(`Prefix symbol '${t}' is not defined.`);return n}static successor(t,n){const e=c.getPrefix(t),o=R.filter(r=>r.exponent>e.exponent&&r.exponent%(n?1:3)===0);if(o.length===0)return t;const i=o.slice(-1)[0];return o.filter(r=>r.exponent===i.exponent)[0].symbol}static predecessor(t,n){const e=c.getPrefix(t),o=R.filter(i=>i.exponent<e.exponent&&i.exponent%(n?1:3)===0);return o.length===0?t:o[0].symbol}},"siValuePattern",/^([+-]?(?:[0-9]*\.)?[0-9]+)([QRYZEPTGMkmuμnpfazyrq]?)$/),self.addEventListener("message",l=>{console.info(`[biquadWorker] start impulseLength: ${l.data.impulseLength}`);const t=z(l.data);console.info(`[biquadWorker] finish impulseLength: ${l.data.impulseLength}`),self.postMessage(t)});function z(l){const t=new M(l.impulseLength);t.setFilter(l.filterType,l.samplingFreq,l.cutoffFreq,{q:l.q,gain:l.gain}),t.transform();const n=f(t.frequencyResponse);return{magnitudeOnCutoff:(t.frequencyResponse[Math.floor(l.cutoffFreq/l.samplingFreq*l.impulseLength)]+t.frequencyResponse[Math.floor(l.cutoffFreq/l.samplingFreq*l.impulseLength+1)])/2,maxMagnitude:n.max,minMagnitude:n.min,maxMagnitudeFrequency:l.samplingFreq/l.impulseLength*n.maxIndex,minMagnitudeFrequency:l.samplingFreq/l.impulseLength*n.minIndex,sumImpulse:t.impluseResponse.reduce((e,o)=>e+o,0)}}})();
