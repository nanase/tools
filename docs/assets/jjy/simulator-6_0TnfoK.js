import{a4 as de,X as ce,a5 as O,d as W,Y as ie,r as i,o as A,b as H,e as R,F as G,c as X,w as n,a as t,h as f,s as $,t as h,u as y,j as _,m as fe,k as me,f as x,a6 as ve,W as ye,_ as pe,i as _e}from"../tools-ToolAppBase.vue_vue_type_script_setup_true_lang-BJ6W5dVp.js";import{o as j}from"../tools-SIValueInput.vue_vue_type_script_setup_true_lang-CvgRkyND.js";import{n as Ve,_ as be,s as Se,d as ge,M as ke}from"../tools-SignalIndicator.vue_vue_type_style_index_0_lang-BkyCRujO.js";import{_ as q}from"../tools-InputRow.vue_vue_type_script_setup_true_lang-RnAkmi3n.js";import{u as E}from"../tools-index-CwfruueO.js";var K={exports:{}};(function(a,e){(function(s,p){a.exports=p()})(de,function(){return function(s,p,m){p.prototype.dayOfYear=function(d){var V=Math.round((m(this).startOf("day")-m(this).startOf("year"))/864e5)+1;return d==null?V:this.add(d-V,"day")}}})})(K);var Oe=K.exports;const Ye=ce(Oe);O.extend(Ye);const Je=[{title:"予定なし",value:0},{title:"7日以内に実施",value:1},{title:"3～6日以内に実施",value:2},{title:"2日以内に実施",value:3},{title:"24時間以内に実施",value:4},{title:"12時間以内に実施",value:5},{title:"2時間以内に実施",value:6}],je=[{title:"予定なし",value:0},{title:"7日間以上または期限未定",value:1},{title:"2～6日間",value:2},{title:"2日間以内",value:3}],Te=[{title:"毎時15分および45分",value:"default"},{title:"強制",value:"force"},{title:"なし",value:"disable"}],Pe={P:"ポジションマーカー",0:"ビット 0",1:"ビット 1",S:"JJY コールサイン"},we={P:"高出力 0.2秒、低出力 0.8秒",0:"高出力 0.8秒、低出力 0.2秒",1:"高出力 0.5秒、低出力 0.5秒",S:"・－－－ ・－－－ －・－－（モールスで2回以内）"},r=a=>(a??!1)==0?"0":"1";function L(a){let e=!1;for(;a!==0;)a&1&&(e=!e),a>>=1;return e}function Ce(a,e){const s=O(a).startOf("minute"),p=[];a.subtract;for(let m=0;m<60;m++)p[m]=Ne(s.add(m,"seconds"),e);return p}function Q(a,e){return((e==null?void 0:e.callSign)==="force"||a.minute()===15||a.minute()===45)&&(e==null?void 0:e.callSign)!=="disable"}function Ne(a,e){const s=Q(a,e);switch(a.second()){case 0:return"P";case 1:return r(a.minute()/10&4);case 2:return r(a.minute()/10&2);case 3:return r(a.minute()/10&1);case 4:return"0";case 5:return r(a.minute()%10&8);case 6:return r(a.minute()%10&4);case 7:return r(a.minute()%10&2);case 8:return r(a.minute()%10&1);case 9:return"P";case 10:case 11:return"0";case 12:return r(a.hour()/10&2);case 13:return r(a.hour()/10&1);case 14:return"0";case 15:return r(a.hour()%10&8);case 16:return r(a.hour()%10&4);case 17:return r(a.hour()%10&2);case 18:return r(a.hour()%10&1);case 19:return"P";case 20:case 21:return"0";case 22:return r(a.dayOfYear()/100&2);case 23:return r(a.dayOfYear()/100&1);case 24:return"0";case 25:return r(a.dayOfYear()/10%10&8);case 26:return r(a.dayOfYear()/10%10&4);case 27:return r(a.dayOfYear()/10%10&2);case 28:return r(a.dayOfYear()/10%10&1);case 29:return"P";case 30:return r(a.dayOfYear()%10&8);case 31:return r(a.dayOfYear()%10&4);case 32:return r(a.dayOfYear()%10&2);case 33:return r(a.dayOfYear()%10&1);case 34:return"0";case 35:return"0";case 36:return r(L(a.hour()/10<<4|a.hour()%10));case 37:return r(L(a.minute()/10<<4|a.minute()%10));case 38:return r(e==null?void 0:e.summerTimeNotice);case 39:return"P";case 40:return s?"S":r(e==null?void 0:e.summerTime);case 41:return s?"S":r(a.year()%100/10&8);case 42:return s?"S":r(a.year()%100/10&4);case 43:return s?"S":r(a.year()%100/10&2);case 44:return s?"S":r(a.year()%100/10&1);case 45:return s?"S":r(a.year()%10&8);case 46:return s?"S":r(a.year()%10&4);case 47:return s?"S":r(a.year()%10&2);case 48:return s?"S":r(a.year()%10&1);case 49:return"P";case 50:return r(s?((e==null?void 0:e.stopAfter)??0)&4:a.day()&4);case 51:return r(s?((e==null?void 0:e.stopAfter)??0)&2:a.day()&2);case 52:return r(s?((e==null?void 0:e.stopAfter)??0)&1:a.day()&1);case 53:return s&&(e==null?void 0:e.stopAfter)!==0?r(e==null?void 0:e.stopType):r(e==null?void 0:e.leapSecondNotice);case 54:return s&&(e==null?void 0:e.stopAfter)!==0?r(((e==null?void 0:e.stopDuration)??0)&2):r((e==null?void 0:e.leapSecondNotice)&&(e==null?void 0:e.leapSecondType));case 55:return s&&(e==null?void 0:e.stopAfter)!==0?r(((e==null?void 0:e.stopDuration)??0)&1):"0";case 56:case 57:case 58:return"0";case 59:return"P";default:return console.info("invalid time",a),"0"}}function Ue(a,e){switch(a){case 0:return"M: 開始を表すポジションマーカー（固定）";case 1:return"分の重み（40）";case 2:return"分の重み（20）";case 3:return"分の重み（10）";case 4:return"未使用（常にビット 0）";case 5:return"分の重み（8）";case 6:return"分の重み（4）";case 7:return"分の重み（2）";case 8:return"分の重み（1）";case 9:return"P1: ポジションマーカー（固定）";case 10:case 11:return"未使用（常にビット 0）";case 12:return"時の重み（20）";case 13:return"時の重み（10）";case 14:return"未使用（常にビット 0）";case 15:return"時の重み（8）";case 16:return"時の重み（4）";case 17:return"時の重み（2）";case 18:return"時の重み（1）";case 19:return"P2: ポジションマーカー（固定）";case 20:case 21:return"未使用（常にビット 0）";case 22:return"年の通算日の重み（200）";case 23:return"年の通算日の重み（100）";case 24:return"未使用（常にビット 0）";case 25:return"年の通算日の重み（80）";case 26:return"年の通算日の重み（40）";case 27:return"年の通算日の重み（20）";case 28:return"年の通算日の重み（10）";case 29:return"P3: ポジションマーカー（固定）";case 30:return"年の通算日の重み（8）";case 31:return"年の通算日の重み（4）";case 32:return"年の通算日の重み（2）";case 33:return"年の通算日の重み（1）";case 34:case 35:return"未使用（常にビット 0）";case 36:return"PA1: 「時」部のビットの偶数パリティ";case 37:return"PA2: 「分」部のビットの偶数パリティ";case 38:return"SU1: 6日以内に夏時間開始または終了のときビット 1";case 39:return"P4: ポジションマーカー（固定）";case 40:return e?"「JJY」を表すコールサイン":"SU2: 夏時間実施中のときビット 1";case 41:return e?"「JJY」を表すコールサイン":"年の重み（80）";case 42:return e?"「JJY」を表すコールサイン":"年の重み（40）";case 43:return e?"「JJY」を表すコールサイン":"年の重み（20）";case 44:return e?"「JJY」を表すコールサイン":"年の重み（10）";case 45:return e?"「JJY」を表すコールサイン":"年の重み（8）";case 46:return e?"「JJY」を表すコールサイン":"年の重み（4）";case 47:return e?"「JJY」を表すコールサイン":"年の重み（2）";case 48:return e?"「JJY」を表すコールサイン":"年の重み（1）";case 49:return"P5: ポジションマーカー（固定）";case 50:return e?"ST1: 停波が開始するまでの時間の上位1ビット目":"日曜日を起点とした曜日の上位1ビット目";case 51:return e?"ST2: 停波が開始するまでの時間の上位2ビット目":"日曜日を起点とした曜日の上位2ビット目";case 52:return e?"ST3: 停波が開始するまでの時間の上位3ビット目":"日曜日を起点とした曜日の上位3ビット目";case 53:return e?"ST4: 停波が昼間のみのときビット 1":"LS1: 月末に閏秒が実施されるときビット 1";case 54:return e?"ST5: 停波の期間の上位1ビット目":"LS2: 実施される閏秒の種別が挿入のときビット 1、削除のときビット 0";case 55:return e?"ST6: 停波の期間の上位2ビット目":"未使用（常にビット 0）";case 56:case 57:case 58:return"未使用（常にビット 0）";case 59:return"P0: ポジションマーカー（固定）";default:return console.info("invalid time",a),""}}const he={class:"title"},Ae=W({__name:"TimeBars",props:ie({timeCodes:null,time:null,jjyOptions:null,length:null,offset:null},{offset:0}),setup(a){return(e,s)=>{const p=i("v-tooltip"),m=i("v-sheet");return A(!0),H(G,null,R(e.timeCodes.slice(e.offset,e.length+e.offset),(d,V)=>(A(),X(m,{key:V,class:$(["timebar d-inline-flex justify-center align-center",{now:e.time.second()===e.offset+V,"marker-position":d==="P","marker-zero":d==="0","marker-one":d==="1","marker-sign":d==="S"}])},{default:n(()=>[t(p,{activator:"parent",location:"bottom","open-delay":"100",class:"timebar-tooltip"},{default:n(()=>[f("div",he,[f("div",{class:$(["legend",{"marker-position":d==="P","marker-zero":d==="0","marker-one":d==="1","marker-sign":d==="S"}])},null,2),f("span",null,h(e.offset+V)+": "+h(y(Pe)[d]),1)]),f("div",null,h(y(Ue)(e.offset+V,y(Q)(e.time,e.jjyOptions))),1),f("div",null,h(y(we)[d]),1)]),_:2},1024)]),_:2},1032,["class"]))),128)}}}),xe=W({__name:"SimulatorApp",setup(a){const e=_(O()),s=_(O().startOf("second")),p=_(O().startOf("minute")),m=_(),d=_(!0),V=_(0),D=fe(()=>Ce(p.value,c.value)),c=_({callSign:"default",leapSecondType:!0,stopAfter:0,stopDuration:3}),g=_(),Y=_(),C=_(440),T=_(.5),M=_(-1/0);let S=null,N=null,P=!1;E(()=>{m.value||(e.value=O().subtract(V.value,"milliseconds")),s.value.unix()!=e.value.unix()&&(s.value=e.value.startOf("second"),e.value.diff(p.value,"seconds")>=60&&(p.value=e.value.startOf("minute")))},50),me(()=>s.value,()=>{if(!g.value)return;let k=Ve();function l(b,w){const U=Y.value?13333.333:Number.isFinite(Number(C.value))?Math.min(Math.max(Number(C.value),20),24e3):440;S!=null&&(S.oscillator.type=Y.value?"square":"sine",S.triggerAttackRelease(U,b,k,T.value*(w?1:.1))),k+=b}function o(){l(.25,!0),l(.1,!1)}function v(){l(.1,!0),l(.1,!1)}switch(D.value[s.value.second()]){case"P":{P=!1,l(.2,!0),l(.8+1,!1);break}case"0":{P=!1,l(.8,!0),l(.2+1,!1);break}case"1":{P=!1,l(.5,!0),l(.5+1,!1);break}case"S":{if(!P){P=!0;for(let b=0;b<2;b++)l(.3,!1),v(),o(),o(),o(),l(.05,!1),v(),o(),o(),o(),l(.05,!1),o(),v(),o(),o(),l(.05,!1);l(.6+.1,!1)}break}}});function Z(){d.value||(V.value=0,m.value=!1)}function ee(){m.value?V.value=O().diff(e.value,"milliseconds"):d.value=!1}async function z(){!g.value&&S==null?(await Se(),S=new ge({envelope:{attack:.05,decay:.05,sustain:.8,release:.05}}).toDestination(),N=new ke({smoothing:0}),S.connect(N)):S==null||S.triggerRelease()}return E(()=>{if(N){const k=N.getValue();M.value=Array.isArray(k)?k[0]:k}},100),(k,l)=>{const o=i("v-col"),v=i("v-checkbox"),b=i("v-row"),w=i("v-select"),U=i("v-radio"),ae=i("v-radio-group"),I=i("v-divider"),B=i("v-btn"),le=i("v-card-text"),te=i("v-slider"),F=i("v-container"),re=i("v-spacer"),ue=i("v-card-actions"),ne=i("v-card"),se=i("v-dialog"),oe=i("v-footer");return A(),X(pe,{"page-id":"jjy/simulator","toolbar-title":"JJY シミュレータ"},{footer:n(()=>[t(I),t(oe,null,{default:n(()=>[t(F,null,{default:n(()=>l[20]||(l[20]=[f("h4",null,"参考文献",-1),f("ul",null,[f("li",null,[f("a",{href:"https://jjy.nict.go.jp/jjy/trans/index.html",target:"_blank"},"標準電波の出し方"),x(" - 情報通信研究機構 日本標準時グループ ")]),f("li",null,[f("a",{href:"https://ja.wikipedia.org/wiki/JJY",target:"_blank"},"JJY"),x(" - Wikipedia")]),f("li",null,[f("a",{href:"https://shogo82148.github.io/web-jjy/",target:"_blank"},"JJYシミュレータWeb版")])],-1)])),_:1})]),_:1})]),default:n(()=>[t(b,{"no-gutters":"",align:"center",justify:"center"},{default:n(()=>[t(o,{cols:"5",sm:"7"},{default:n(()=>[t(y(ve),{time:e.value,style:{"font-size":"125%"}},null,8,["time"])]),_:1}),t(o,{cols:"3",sm:"2"},{default:n(()=>[t(v,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=u=>m.value=u),label:"停止",color:"red","hide-details":"",onClick:ee},null,8,["modelValue"])]),_:1}),t(o,{cols:"4",sm:"3"},{default:n(()=>[t(v,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=u=>d.value=u),label:"現在の時刻","hide-details":"",onClick:Z,readonly:d.value},null,8,["modelValue","readonly"])]),_:1})]),_:1}),t(b,{"no-gutters":""},{default:n(()=>[(A(),H(G,null,R(2,u=>t(o,{cols:"12",key:u,class:"d-flex justify-center"},{default:n(()=>[t(Ae,{"time-codes":D.value,time:s.value,jjyOptions:c.value,length:30,offset:(u-1)*30},null,8,["time-codes","time","jjyOptions","offset"])]),_:2},1024)),64))]),_:1}),t(b,null,{default:n(()=>[t(o,{cols:"6",sm:"4",lg:"3"},{default:n(()=>[t(w,{label:"コールサイン",density:"compact",variant:"underlined",modelValue:c.value.callSign,"onUpdate:modelValue":l[2]||(l[2]=u=>c.value.callSign=u),items:y(Te)},null,8,["modelValue","items"])]),_:1}),t(o,{cols:"6",sm:"4",lg:"3"},{default:n(()=>[t(v,{modelValue:c.value.summerTime,"onUpdate:modelValue":l[3]||(l[3]=u=>c.value.summerTime=u),label:"夏時間実施中","hide-details":"",density:"compact"},null,8,["modelValue"]),t(v,{modelValue:c.value.summerTimeNotice,"onUpdate:modelValue":l[4]||(l[4]=u=>c.value.summerTimeNotice=u),label:"6日以内に夏時間を開始または終了","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1}),t(o,{cols:"6",sm:"4",lg:"3"},{default:n(()=>[t(v,{modelValue:c.value.leapSecondNotice,"onUpdate:modelValue":l[5]||(l[5]=u=>c.value.leapSecondNotice=u),label:"月末に閏秒を実施","hide-details":"",density:"compact"},null,8,["modelValue"]),t(ae,{modelValue:c.value.leapSecondType,"onUpdate:modelValue":l[6]||(l[6]=u=>c.value.leapSecondType=u),disabled:!(c.value.leapSecondNotice??!1),direction:"horizontal",density:"compact"},{default:n(()=>[t(U,{label:"挿入",value:!0}),t(U,{label:"削除",value:!1})]),_:1},8,["modelValue","disabled"])]),_:1}),t(o,{cols:"6",sm:"4",lg:"3"},{default:n(()=>[t(w,{label:"停波",density:"compact",variant:"underlined",modelValue:c.value.stopAfter,"onUpdate:modelValue":l[7]||(l[7]=u=>c.value.stopAfter=u),items:y(Je)},null,8,["modelValue","items"]),t(w,{label:"停波期間",density:"compact",variant:"underlined",modelValue:c.value.stopDuration,"onUpdate:modelValue":l[8]||(l[8]=u=>c.value.stopDuration=u),items:y(je).slice(1)},null,8,["modelValue","items"]),t(v,{modelValue:c.value.stopType,"onUpdate:modelValue":l[9]||(l[9]=u=>c.value.stopType=u),label:"停波は昼間のみ","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1}),t(I)]),_:1}),t(b,null,{default:n(()=>[t(o,{cols:"6",sm:"4",lg:"3"},{default:n(()=>[t(v,{modelValue:g.value,"onUpdate:modelValue":l[10]||(l[10]=u=>g.value=u),label:"音の再生","hide-details":"",onClick:z,density:"compact"},{append:n(()=>[t(be,{value:M.value,max:-10,min:-30,disabled:!g.value},null,8,["value","disabled"])]),_:1},8,["modelValue"]),t(v,{modelValue:Y.value,"onUpdate:modelValue":l[11]||(l[11]=u=>Y.value=u),label:"時刻合わせモード","hide-details":"",density:"compact"},null,8,["modelValue"]),t(se,{"max-width":"640"},{activator:n(({props:u})=>[t(B,ye(u,{"prepend-icon":"mdi-help",variant:"outlined"}),{default:n(()=>l[17]||(l[17]=[x("時刻合わせのやりかた")])),_:2},1040)]),default:n(({isActive:u})=>[t(ne,{title:"時刻合わせのやりかた"},{default:n(()=>[t(le,null,{default:n(()=>l[18]||(l[18]=[f("p",null," お使いのデバイスにスピーカーまたはイヤホンを接続して「音の再生」と「時刻合わせモード」を有効にしてください。スピーカーまたはイヤホンの配線部分に電波時計を近づけると受信が始まります。 ",-1),f("p",null," サウンドデバイスによってはローパスフィルターによって 40kHz の信号が生成できず時刻合わせができない場合があります。時刻合わせによって生じた問題について責任は負いかねます。ご了承ください。 ",-1)])),_:1}),t(F,{class:"py-0"},{default:n(()=>[t(b,{"no-gutters":""},{default:n(()=>[t(o,{cols:"6"},{default:n(()=>[t(v,{modelValue:g.value,"onUpdate:modelValue":l[12]||(l[12]=J=>g.value=J),label:"音の再生","hide-details":"",onClick:z,density:"compact"},null,8,["modelValue"])]),_:1}),t(o,{cols:"6"},{default:n(()=>[t(v,{modelValue:Y.value,"onUpdate:modelValue":l[13]||(l[13]=J=>Y.value=J),label:"時刻合わせモード","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1}),t(o,{cols:"12"},{default:n(()=>[l[19]||(l[19]=f("div",{class:"text-caption"},"ボリューム",-1)),t(te,{modelValue:T.value,"onUpdate:modelValue":l[14]||(l[14]=J=>T.value=J),min:"0",max:"1","thumb-label":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(ue,null,{default:n(()=>[t(re),t(B,{text:"閉じる",onClick:J=>u.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1}),t(o,{cols:"6",sm:"4",lg:"3"},{default:n(()=>[t(q,{modelValue:C.value,"onUpdate:modelValue":l[15]||(l[15]=u=>C.value=u),label:"音の周波数",variant:"underlined",density:"compact",max:24e3,min:20,scale:"log",unit:"Hz",rule:[y(j).required,y(j).value,y(j).notNegative],cols:"5","hide-details":""},null,8,["modelValue","rule"]),t(q,{modelValue:T.value,"onUpdate:modelValue":l[16]||(l[16]=u=>T.value=u),label:"ボリューム",variant:"underlined",density:"compact",max:1,min:0,"fraction-digits":3,rule:[y(j).required,y(j).value,y(j).notNegative],cols:"5","hide-details":""},null,8,["modelValue","rule"])]),_:1})]),_:1})]),_:1})}}});_e("#app",xe);
